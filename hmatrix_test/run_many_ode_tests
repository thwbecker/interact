#!/bin/bash
#
# run a bunch of ODE solver tests to make plots of attractors
#

ks=${1-"0.93312950 0.86164850 0.85621575 0.85522170 0.85501330 0.85496885 0.85495935 0.85495730 0.8525"}
imode=${2-0}			# init mode
force=${3-0}			# make new ?


for k in $ks;do
    kf=`echo $k | awk -v imode=$imode '{printf("state.%020.15f.%i.dat",$1,imode)}'`
    #sopt=""
    sopt="-log_state  -atol 1e-15 -rtol 1e-16"
    sopt="$sopt -t_final 1e7  -monitor_tmin .999e7"
    sopt="$sopt -imode $imode"
    # default, works
    #popt="-ts_monitor -ts_adopt_monitor $sopt"
    popt="$sopt"

    echo
    echo $k
    echo
    #rm  $kf > /dev/null
    if [[ ! -s $kf || $force -eq 1 ]];then
	bin/ode_solve_test $popt -knd $k
	if [[ ! -s $kf || `wc -l $kf | awk '{print($1)}'` -lt 1000 ]];then
	    echo $0: solver error for $k could not find $kf `wc -l $kf`
	    exit
	fi
    else
	echo $0: not running because $kf exists
    fi
done


