#!/bin/bash
# make geometry
gawk -v pi=`pi` 'BEGIN{
pif=180/pi;
dip=pi/2;
x0=y0=0;
nx=25;
r=10;d=10;
w=d/nx;
dazi=pi/2/(nx*2);
for(azi=dazi/2;azi < pi/2+1e-6;azi+=dazi){
i=1;
for(a=azi-dazi/2;a<azi+dazi/2+1e-6;a+=dazi/2){
	x[i]=x0+sin(a)*r;
	y[i]=y0+cos(a)*r;
	i++;
}
l=sqrt((x[3]-x[1])**2+(y[3]-y[1])**2);
for(z=w/2;z<d;z+=w){
print(x[2],y[2],-z,(azi-pi/2)*pif,dip*pif,l/2,w/2,0)
}
}
}' > geom.in
# friction coefficients
gawk '{print(0.6,0.5)}' geom.in > fp.in

# need to fix / what's the sign convention?
#echo 0 0 0 5e4 1e4 30 | calc_cart_from_eigen_stress -ah | \
#    gawk '{for(i=4;i<=9;i++)print($i,0)}' > smlin.in

for bc in 50 51;do
    if [ $bc = 50 ];then
	makecpt -T0/3/.1 -I -Croma > vel.cpt
	lspc=0.5
    else
	makecpt -T0/1.5/.05 -I -Croma > vel.cpt
	lspc=0.25
    fi
    cat <<EOF > bc.in
1 0
-1 -1 -1 $bc 1
EOF

    interact 
    cat geom.in | patch2xyz flt.dat 3 > geom.xyz

    reg=`minmax -I.1 geom.xyz -m`/-15/0
    proj="-JX7 -JZ7"

    psxyz -m $reg $proj -E30/30 geom.xyz -m -P -L -Cvel.cpt \
	  -W0.5  -Ba5f1:"x":/a5f1:"y":/a5f1WESNZ+0 -K > slip.$bc.ps
    psscale -D5/3/5/.25h -Ef -B$lspc/:"slip": -Cvel.cpt -O >> slip.$bc.ps
    modifybb slip.$bc.ps

    cp flt.dat flt.$bc.dat
done


